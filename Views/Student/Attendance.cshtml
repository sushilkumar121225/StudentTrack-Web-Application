@{
    ViewData["Title"] = "Student Attendance";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - StudentTrack</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />

    <style>
        body {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
        }

        .attendance-container {
            max-width: 950px;
            margin: 60px auto;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            animation: slideUp 0.9s ease;
        }

        .attendance-header {
            background: linear-gradient(90deg, #36d1dc, #5b86e5);
            color: #fff;
            text-align: center;
            padding: 40px 20px;
        }

            .attendance-header h2 {
                font-weight: 700;
            }

        .table thead {
            background: #5b86e5;
            color: #fff;
        }

        .btn-status {
            padding: 5px 20px;
            border-radius: 20px;
            border: none;
            color: #fff;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn-present {
            background-color: #28a745;
        }

            .btn-present:hover {
                background-color: #218838;
            }

        .btn-absent {
            background-color: #dc3545;
        }

            .btn-absent:hover {
                background-color: #c82333;
            }

        .summary-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
            text-align: center;
            font-weight: 600;
            margin: 20px 0;
        }

        @@keyframes slideUp {
            from

        {
            transform: translateY(30px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }

        }
    </style>
</head>

<body>
    <div class="attendance-container shadow">
        <div class="attendance-header">
            <h2>📅 Student Attendance</h2>
            <p class="lead">Mark your daily attendance for subjects below</p>
        </div>

        <div class="p-4">
            <table class="table table-hover text-center align-middle" id="attendanceTable">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Mathematics</td>
                        <td><span class="date-cell"></span></td>
                        <td>
                            <button class="btn-status btn-present">Present</button>
                            <button class="btn-status btn-absent">Absent</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Computer Science</td>
                        <td><span class="date-cell"></span></td>
                        <td>
                            <button class="btn-status btn-present">Present</button>
                            <button class="btn-status btn-absent">Absent</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Physics</td>
                        <td><span class="date-cell"></span></td>
                        <td>
                            <button class="btn-status btn-present">Present</button>
                            <button class="btn-status btn-absent">Absent</button>
                        </td>
                    </tr>
                    <tr>
                        <td>English</td>
                        <td><span class="date-cell"></span></td>
                        <td>
                            <button class="btn-status btn-present">Present</button>
                            <button class="btn-status btn-absent">Absent</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Electronics</td>
                        <td><span class="date-cell"></span></td>
                        <td>
                            <button class="btn-status btn-present">Present</button>
                            <button class="btn-status btn-absent">Absent</button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="summary-box">
                ✅ Present: <span id="presentCount">0</span> | ❌ Absent: <span id="absentCount">0</span>
            </div>

            <div class="text-center">
                <button class="btn btn-primary px-4 py-2" id="saveAttendance">💾 Save Attendance</button>
                <button class="btn btn-success px-4 py-2 ms-2" id="downloadReport">⬇️ Download Report</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize current date for all rows
        const dateCells = document.querySelectorAll(".date-cell");
        const today = new Date().toLocaleDateString();
        dateCells.forEach(cell => cell.innerText = today);

        // Load saved data
        let attendanceData = JSON.parse(localStorage.getItem("studentAttendance")) || {};

        const tableRows = document.querySelectorAll("#attendanceTable tbody tr");
        const presentCount = document.getElementById("presentCount");
        const absentCount = document.getElementById("absentCount");

        // Set previous states
        tableRows.forEach((row, index) => {
            const subject = row.cells[0].innerText;
            const status = attendanceData[subject];
            if (status) {
                highlightButton(row, status);
            }
        });
        updateSummary();

        // Event listeners for present/absent buttons
        document.querySelectorAll(".btn-present, .btn-absent").forEach(button => {
            button.addEventListener("click", function () {
                const row = this.closest("tr");
                const subject = row.cells[0].innerText;
                const status = this.classList.contains("btn-present") ? "Present" : "Absent";

                attendanceData[subject] = status;
                highlightButton(row, status);
                updateSummary();
            });
        });

        // Highlight chosen button
        function highlightButton(row, status) {
            const presentBtn = row.querySelector(".btn-present");
            const absentBtn = row.querySelector(".btn-absent");
            if (status === "Present") {
                presentBtn.classList.add("active");
                absentBtn.classList.remove("active");
                presentBtn.style.opacity = "1";
                absentBtn.style.opacity = "0.5";
            } else {
                absentBtn.classList.add("active");
                presentBtn.classList.remove("active");
                absentBtn.style.opacity = "1";
                presentBtn.style.opacity = "0.5";
            }
        }

        // Save to localStorage
        document.getElementById("saveAttendance").addEventListener("click", function () {
            localStorage.setItem("studentAttendance", JSON.stringify(attendanceData));
            alert("✅ Attendance saved successfully!");
        });

        // Download as text report
        document.getElementById("downloadReport").addEventListener("click", function () {
            let report = "Student Attendance Report (" + today + ")\n\n";
            for (let [subject, status] of Object.entries(attendanceData)) {
                report += `${subject}: ${status}\n`;
            }

            const blob = new Blob([report], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "Attendance_Report.txt";
            a.click();
        });

        // Update summary counts
        function updateSummary() {
            let present = 0, absent = 0;
            for (let status of Object.values(attendanceData)) {
                if (status === "Present") present++;
                else if (status === "Absent") absent++;
            }
            presentCount.innerText = present;
            absentCount.innerText = absent;
        }
    </script>
</body>
</html>
